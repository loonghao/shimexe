# Release-plz configuration for shimexe workspace
#
# This configuration handles a mixed workspace where:
# - shimexe (main CLI) is at the root and needs GitHub releases
# - shimexe-core (library) is in crates/ and only needs crates.io publishing

[workspace]
# Global workspace settings
changelog_update = true
# Only main package creates GitHub releases
git_release_enable = false
git_tag_enable = false
# Enable release processing for all packages
release = true
# Update dependencies across workspace
dependencies_update = true

# Changelog configuration
[changelog]
header = """
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

"""

# Main CLI package configuration (at root)
[[package]]
name = "shimexe"
# Enable GitHub releases for main CLI package
git_release_enable = true
git_tag_enable = true
# Standard tag format (triggers release.yml workflow)
git_tag_name = "v{{version}}"
# Enable changelog updates
changelog_update = true
# Enable crates.io publishing
publish = true
# Custom release body template
git_release_body = """
## ðŸš€ What's Changed

{{changelog}}

## ðŸ“¦ Installation

### Download Binary
Download the appropriate binary for your platform from the assets below.

### Using Cargo
```bash
cargo install shimexe
```

### Using Package Managers
```bash
# Homebrew (macOS/Linux)
brew install loonghao/tap/shimexe

# Scoop (Windows)
scoop bucket add loonghao https://github.com/loonghao/scoop-bucket
scoop install shimexe
```

## ðŸ”— Links
- [Documentation](https://docs.rs/shimexe)
- [Examples](https://github.com/loonghao/shimexe/tree/main/examples)
- [Changelog](https://github.com/loonghao/shimexe/blob/main/CHANGELOG.md)

**Full Changelog**: https://github.com/loonghao/shimexe/compare/{{previous_tag}}...{{version}}
"""

# Files to update during release (beyond Cargo.toml and CHANGELOG.md)
update_files = [
  { file = "README.md", search = "shimexe-v[0-9]+\\.[0-9]+\\.[0-9]+", replace = "shimexe-v{{version}}" },
  { file = "README.md", search = "download/v[0-9]+\\.[0-9]+\\.[0-9]+", replace = "download/v{{version}}" },
  { file = "README_zh.md", search = "shimexe-v[0-9]+\\.[0-9]+\\.[0-9]+", replace = "shimexe-v{{version}}" },
  { file = "README_zh.md", search = "download/v[0-9]+\\.[0-9]+\\.[0-9]+", replace = "download/v{{version}}" },
  { file = "pkg/scoop/shimexe.json", search = "\"version\": \"[0-9]+\\.[0-9]+\\.[0-9]+\"", replace = "\"version\": \"{{version}}\"" },
  { file = "pkg/scoop/shimexe.json", search = "shimexe-[0-9]+\\.[0-9]+\\.[0-9]+-", replace = "shimexe-{{version}}-" },
  { file = "pkg/homebrew/shimexe.rb", search = "version \"[0-9]+\\.[0-9]+\\.[0-9]+\"", replace = "version \"{{version}}\"" },
]

# Library package configuration (in crates/)
[[package]]
name = "shimexe-core"
path = "crates/shimexe-core"
# Disable GitHub releases for library (only needs crates.io)
git_release_enable = false
git_tag_enable = false
# Enable crates.io publishing
publish = true
# Enable changelog updates
changelog_update = true
# Changelog path for library
changelog_path = "crates/shimexe-core/CHANGELOG.md"